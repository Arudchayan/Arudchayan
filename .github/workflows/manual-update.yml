name: ğŸ¯ Manual README Update

on:
  workflow_dispatch:
    inputs:
      force_regenerate:
        description: 'Force regenerate even if no changes'
        required: false
        default: 'false'
        type: choice
        options:
          - 'true'
          - 'false'

jobs:
  manual-update:
    name: ğŸ® Manual PokÃ©mon Profile Update
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
    
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: âš¡ Generate README with Fresh PokÃ©mon Data
        run: |
          echo "ğŸ¯ Manually Triggered README Generation!"
          python3 scripts/build_readme.py
          echo "âœ… README Generated!"
      
      - name: ğŸ“Š Show Changes
        run: |
          echo "ğŸ“ Changes made to README.md:"
          git diff README.md || echo "No changes"
      
      - name: ğŸ’¾ Commit and Push
        run: |
          git config user.name "PokÃ©mon Trainer Bot"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          
          # Check if there are changes
          if git diff --quiet README.md; then
            if [ "${{ inputs.force_regenerate }}" == "true" ]; then
              echo "Forcing commit despite no changes..."
              git add README.md
              git commit --allow-empty -m "ğŸ”„ Manual Profile Refresh

ğŸ® Force regenerated by manual trigger
âš¡ Gotta Code 'Em All!

[skip ci]"
              git push
            else
              echo "No changes detected and force_regenerate is false. Skipping commit."
            fi
          else
            ARCHETYPE=$(grep -A 1 "CURRENT_ARCHETYPE_START" README.md | grep "Archetype:" | sed 's/.*Archetype: \*\*//; s/\*\*.*//')
            
            git add README.md
            git commit -m "ğŸ® Manual PokÃ©mon Profile Update

âœ¨ Archetype: ${ARCHETYPE}
ğŸ‘¤ Manually triggered by user
âš¡ Gotta Code 'Em All!

[skip ci]"
            git push
          fi
      
      - name: ğŸ‰ Complete!
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ® Manual Update Complete!"
          echo "âœ¨ Check your GitHub profile!"
          echo "ğŸ’œ GOTTA CODE 'EM ALL!"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
