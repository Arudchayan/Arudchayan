name: ğŸ§ª Test README Build

on:
  pull_request:
    branches:
      - main
      - master
    paths:
      - 'scripts/**'
      - 'data/**'
      - 'README.template.md'
      - '.github/workflows/**'

jobs:
  test-build:
    name: ğŸ§ª Test PokÃ©mon Profile Generation
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
      
      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: âš¡ Test README Generation
        run: |
          echo "ğŸ§ª Testing README generation..."
          python3 scripts/build_readme.py
          echo "âœ… Build script executed successfully!"
      
      - name: ğŸ“Š Validate Output
        run: |
          if [ ! -f README.md ]; then
            echo "âŒ ERROR: README.md was not generated!"
            exit 1
          fi
          
          # Check if README has content
          if [ ! -s README.md ]; then
            echo "âŒ ERROR: README.md is empty!"
            exit 1
          fi
          
          # Check for required sections
          if ! grep -q "POKÃ‰MON TRAINER PROFILE" README.md; then
            echo "âŒ ERROR: README.md missing PokÃ©mon header!"
            exit 1
          fi
          
          if ! grep -q "TEAM CONFIGURATION" README.md; then
            echo "âŒ ERROR: README.md missing team configuration!"
            exit 1
          fi
          
          echo "âœ… README.md validation passed!"
          echo "ğŸ“ File size: $(wc -c < README.md) bytes"
          echo "ğŸ“„ Line count: $(wc -l < README.md) lines"
      
      - name: ğŸ” Show Sample Output
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ“ First 50 lines of generated README:"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          head -50 README.md
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
      
      - name: ğŸ‰ Test Passed!
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… All tests passed!"
          echo "ğŸ® README generation works perfectly!"
          echo "ğŸ’œ GOTTA CODE 'EM ALL!"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
