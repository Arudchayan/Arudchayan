name: ğŸ® Update PokÃ©mon Trainer Profile

on:
  # Run daily at midnight UTC
  schedule:
    - cron: '0 0 * * *'
  
  # Run on push to main/master branch
  push:
    branches:
      - main
      - master
    paths:
      - 'scripts/**'
      - 'data/**'
      - 'README.template.md'
      - '.github/workflows/update-readme.yml'
  
  # Allow manual trigger
  workflow_dispatch:

jobs:
  update-readme:
    name: ğŸ”„ Generate Bonkers PokÃ©mon README
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
    
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: âš¡ Generate README with PokÃ©API Data
        run: |
          echo "ğŸ¯ Starting PokÃ©mon Trainer Profile Generation..."
          python3 scripts/build_readme.py
          echo "âœ… README Generated Successfully!"
      
      - name: ğŸ“Š Check for Changes
        id: check_changes
        run: |
          if git diff --quiet README.md; then
            echo "changed=false" >> $GITHUB_OUTPUT
            echo "No changes detected in README.md"
          else
            echo "changed=true" >> $GITHUB_OUTPUT
            echo "Changes detected in README.md"
          fi
      
      - name: ğŸ’¾ Commit and Push Changes
        if: steps.check_changes.outputs.changed == 'true'
        run: |
          git config user.name "PokÃ©mon Trainer Bot"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          
          # Get current archetype info
          ARCHETYPE=$(grep -A 1 "CURRENT_ARCHETYPE_START" README.md | grep "Archetype:" | sed 's/.*Archetype: \*\*//; s/\*\*.*//')
          
          git add README.md
          git commit -m "ğŸ® Daily PokÃ©mon Profile Update

âœ¨ Archetype: ${ARCHETYPE}
ğŸ¤– Auto-generated by GitHub Actions
âš¡ Gotta Code 'Em All!

[skip ci]"
          
          git push
      
      - name: ğŸ‰ Success!
        if: steps.check_changes.outputs.changed == 'true'
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ® PokÃ©mon Trainer Profile Updated!"
          echo "âš¡ README.md has been regenerated!"
          echo "ğŸ’œ GOTTA CODE 'EM ALL!"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
      
      - name: ğŸ˜´ No Changes
        if: steps.check_changes.outputs.changed == 'false'
        run: |
          echo "â„¹ï¸  No changes needed - README is up to date!"
